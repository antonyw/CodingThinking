# JVM 类加载机制
一个类从被加载到虚拟机内存开始，到卸载出内存为止，它的整个生命周期包括：
1. 加载
2. 验证
3. 准备
4. 解析
5. 初始化
6. 使用
7. 卸载

其中验证、准备、解析3个部分统称为“连接”。

**加载、验证、准备、初始化和卸载这5个阶段顺序是确定的，而解析则不一定，它在某些情况可以在初始化之后再开始**，这是为了支持Java语言的运行时绑定。

## 何时开启加载？
虚拟机规范严格规定有且只有碰到以下五种情况会立即开启类的加载过程：
1. 遇到 new / getstatic / putstatic / invokestatic 这4条指令时，如果类还没有进行过初始化，则需要先触发其初始化。这4条指令对应的场景是：使用new关键字实例化对象、读取或设置一个类的静态字段（被final修饰、已在编译期把结果放入常量池的静态字段除外）、调用一个类的静态方法时。
2. 使用 java.lang.reflect 包的方法对类进行反射调用的时候，如果类还没有进行过初始化，则需要先触发其初始化。
3. 当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。
4. 当虚拟机启动时，用户需要指定一个要执行的主类，虚拟机会先初始化这个主类。
5. 当使用动态语言支持时，如果一个 methodHandler 实例最后解析结果 REF_getStatic / REF_putStatic / REF_invokeStatic 的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化。